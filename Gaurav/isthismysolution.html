<?php
    $info = $_POST["opinfo"];
    echo $info;
    echo "<input type=\"hidden\" id=\"custId\" value=\"".$info."\">";
?>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">
        <link rel="stylesheet" type="text/css" href="../css/common.css">
    
        <title>Output</title>
        <link rel="icon" href="../images/icon.png" type="image/icon type">
    </head>
    <body class="body-inside">
        <div class="center">
            <h1>Sensor Output</h1>
            <button type="button" class="btn btn-danger" style="margin-top:2rem; margin-bottom: 2rem;width:10rem;" onclick="onExitButton">Exit</button>
        </div>
        <p id="sensor-data" class="container"></p>
        <p id="status"></p>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script> 
        <script>
          //document.getElementById("p1").innerHTML = localStorage.getItem('username');    
        var opcode = document.getElementById("custId");

        function onExitButton(){
            var data = opcode.value;
            $.post(url, {opinfo:opcode.value}, function(d) { // jquery function that 'does' the GET request
                    
               });
        }

        function updateTable(moddata){
            document.getElementById("status").innerHTML = moddata[0];
            var table = document.createElement("table");
            table.className = "table table-bordered table-striped text-center";
            var tr = table.insertRow(-1);  
            var th = document.createElement("th");
            th.className = "thead-dark";
            th.innerHTML = "Output";
            tr.appendChild(th);

            for(var i=0;i< moddata.length;i++)
            {
                tr = table.insertRow(-1);
            tabcell = tr.insertCell(-1);
            tabcell.className = "text-center";
            tabcell.innerHTML = moddata[i];
            }
            var divShowData = document.getElementById('sensor-data');
            divShowData.innerHTML = "";
            divShowData.appendChild(table);
        }

         $(document).ready(function(){ //wait until page is ready
          setInterval(function() { // this will execute the function every 1s
               // Variables
               let url = "showOutput.php"; // locaiton of your form page
                
               $.post(url, {opinfo:opcode.value}, function(d) { // jquery function that 'does' the GET request
                data = JSON.parse(d)
                moddata = JSON.parse(data["output"]);

                updateTable(moddata);// when we have a returned request, populate the element above with the body of the returned request ( plain text )
               });
          }, 1000); // here we have set 1s (1000 ms)
         })
        </script>
       </body>
</html>